<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>On-Call Schedules</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        .card {
            border: 1px solid #000;
            padding: 20px;
            margin-bottom: 20px;
        }

        .loading {
            font-size: 18px;
            font-weight: bold;
        }

        .doctor-info {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>On-Call Schedules</h1>

    <div class="card">
        <h2>Consultant On-Call</h2>
        <div id="consultant"></div>
    </div>

    <div class="card">
        <h2>Specialist On-Call</h2>
        <div id="specialist"></div>
    </div>

    <script>
        const apiKey = 'AIzaSyAAv9OhKvEt5A6dpzr3gSfAEDiu8_IL8PQ';
        const spreadsheetId = '1-s7A-sGm19mClB1ryzEYbAWIm9hptVoPqjKZTs9ho7A';

        // Helper function to fetch data from Google Sheets
        async function fetchData(sheetName) {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${sheetName}?key=${apiKey}`;
            const response = await fetch(url);
            const data = await response.json();
            return data.values;
        }

        // Function to determine the current on-call doctor for consultant or specialist
        function findCurrentOnCall(data) {
            const now = new Date();
            const todayStr = now.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });

            for (let i = 1; i < data.length; i++) {
                const [date, , erShift1, erShift2, wardShift2, erShift3, wardShift3] = data[i];
                if (date === todayStr) {
                    // Determine which shift is currently active based on the current time
                    const currentHour = now.getHours();

                    if (currentHour >= 8 && currentHour < 16) {
                        return { doctor: erShift1, shift: '08:00 - 16:00' };
                    } else if (currentHour >= 16 && currentHour < 0) {
                        return { doctor: erShift2, wardDoctor: wardShift2, shift: '16:00 - 00:00' };
                    } else {
                        return { doctor: erShift3, wardDoctor: wardShift3, shift: '00:00 - 08:00' };
                    }
                }
            }
            return null;
        }

        // Display consultant on-call information
        async function displayConsultantOnCall() {
            const data = await fetchData('Sheet1');
            const consultantOnCall = findCurrentOnCall(data);

            const consultantDiv = document.getElementById('consultant');
            if (consultantOnCall) {
                consultantDiv.innerHTML = `
                    <p class="doctor-info">Doctor: ${consultantOnCall.doctor}</p>
                    <p>Duty Time: ${consultantOnCall.shift}</p>
                `;
            } else {
                consultantDiv.textContent = 'No consultant is currently on-call.';
            }
        }

        // Display specialist on-call information
        async function displaySpecialistOnCall() {
            const data = await fetchData('Sheet2');
            const specialistOnCall = findCurrentOnCall(data);

            const specialistDiv = document.getElementById('specialist');
            if (specialistOnCall) {
                specialistDiv.innerHTML = `
                    <p class="doctor-info">ER Doctor: ${specialistOnCall.doctor}</p>
                    <p>Ward Doctor: ${specialistOnCall.wardDoctor || 'N/A'}</p>
                    <p>Duty Time: ${specialistOnCall.shift}</p>
                `;
            } else {
                specialistDiv.textContent = 'No specialist is currently on-call.';
            }
        }

        displayConsultantOnCall();
        displaySpecialistOnCall();
    </script>
</body>
</html>