<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>On-Call Schedules</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            width: 90%;
            margin: 20px auto;
            text-align: center;
        }
        .card {
            border: 1px solid #000;
            padding: 15px;
            margin: 10px;
            border-radius: 8px;
        }
        .card h2 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        .card p {
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>On-Call Schedules</h1>
        <div class="card" id="consultant-info">
            <h2>Consultant On-Call</h2>
            <p>No consultant is currently on-call.</p>
        </div>
        <div class="card" id="specialist-info">
            <h2>Specialist On-Call</h2>
            <p>Loading...</p>
        </div>
    </div>

    <script>
        const apiKey = "AIzaSyAAv9OhKvEt5A6dpzr3gSfAEDiu8_IL8PQ";
        const sheetId = "1-s7A-sGm19mClB1ryzEYbAWIm9hptVoPqjKZTs9ho7A";
        const consultantSheet = "Sheet1";
        const specialistSheet = "Sheet2";

        function fetchData(sheetName, callback) {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}?key=${apiKey}`;
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const rows = data.values.slice(1); // Skip headers
                    callback(rows);
                })
                .catch(error => console.error('Error fetching data:', error));
        }

        function findCurrentShift(data) {
            const now = new Date();
            for (const row of data) {
                const [dateStr, , doctor, dutyTime, contact] = row;
                const [startTimeStr, endTimeStr] = dutyTime.split(" - ");
                
                const dateParts = dateStr.split("/");
                const startTime = new Date(`${dateParts[2]}-${dateParts[1]}-${dateParts[0]}T${startTimeStr}:00`);
                const endTime = new Date(`${dateParts[2]}-${dateParts[1]}-${dateParts[0]}T${endTimeStr}:00`);
                
                if (endTime < startTime) {
                    endTime.setDate(endTime.getDate() + 1); // Handle overnight shifts
                }

                if (now >= startTime && now <= endTime) {
                    return { doctor, contact, dutyTime };
                }
            }
            return null;
        }

        function findSpecialistShift(data) {
            const now = new Date();
            for (const row of data) {
                const [dateStr, , shift1ER, shift2ER, shift2Ward, shift3ER, shift3Ward] = row;

                const dateParts = dateStr.split("/");
                const currentTime = now.getHours();

                // Determine shift based on time
                if (currentTime >= 8 && currentTime < 16) {
                    return { er: shift1ER, ward: "N/A", shift: "Shift 1 (08:00 - 16:00)" };
                } else if (currentTime >= 16 && currentTime < 24) {
                    return { er: shift2ER, ward: shift2Ward, shift: "Shift 2 (16:00 - 00:00)" };
                } else {
                    return { er: shift3ER, ward: shift3Ward, shift: "Shift 3 (00:00 - 08:00)" };
                }
            }
            return null;
        }

        function updateConsultantInfo() {
            fetchData(consultantSheet, rows => {
                const shift = findCurrentShift(rows);
                const consultantInfoDiv = document.getElementById("consultant-info");

                if (shift) {
                    consultantInfoDiv.innerHTML = `
                        <h2>Consultant On-Call</h2>
                        <p><strong>Doctor:</strong> Dr.${shift.doctor}</p>
                        <p><strong>Contact:</strong> ${shift.contact}</p>
                        <p><strong>Duty Time:</strong> ${shift.dutyTime}</p>
                    `;
                } else {
                    consultantInfoDiv.innerHTML = `
                        <h2>Consultant On-Call</h2>
                        <p>No consultant is currently on-call.</p>
                    `;
                }
            });
        }

        function updateSpecialistInfo() {
            fetchData(specialistSheet, rows => {
                const shift = findSpecialistShift(rows);
                const specialistInfoDiv = document.getElementById("specialist-info");

                if (shift) {
                    specialistInfoDiv.innerHTML = `
                        <h2>Specialist On-Call</h2>
                        <p><strong>Current Shift:</strong> ER: ${shift.er}, Ward: ${shift.ward}</p>
                    `;
                } else {
                    specialistInfoDiv.innerHTML = `
                        <h2>Specialist On-Call</h2>
                        <p>No specialist is currently on-call.</p>
                    `;
                }
            });
        }

        updateConsultantInfo();
        updateSpecialistInfo();
    </script>
</body>
</html>