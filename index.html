<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Specialist On-Call</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        .card {
            border: 1px solid #000;
            padding: 20px;
            margin-bottom: 20px;
        }

        .loading {
            font-size: 18px;
            font-weight: bold;
        }

        .doctor-info {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Specialist On-Call</h1>

    <div class="card">
        <h2>Specialist On-Call</h2>
        <div id="specialist"></div>
    </div>

    <script>
        const apiKey = 'AIzaSyAAv9OhKvEt5A6dpzr3gSfAEDiu8_IL8PQ';
        const spreadsheetId = '1-s7A-sGm19mClB1ryzEYbAWIm9hptVoPqjKZTs9ho7A';

        // Helper function to fetch data from Google Sheets
        async function fetchData(sheetName) {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${sheetName}?key=${apiKey}`;
            const response = await fetch(url);
            const data = await response.json();
            return data.values;
        }

        // Function to determine the current shift for specialist
        function findCurrentShift(data) {
            const now = new Date();
            const todayStr = now.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });

            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                const date = row[0];  // First column is the date

                if (date === todayStr) {
                    const currentHour = now.getHours();

                    if (currentHour >= 8 && currentHour < 16) {
                        return { erDoctor: row[2], wardDoctor: null, shift: '08:00 - 16:00' };  // Shift 1 ER only
                    } else if (currentHour >= 16 && currentHour < 24) {
                        return { erDoctor: row[3], wardDoctor: row[4], shift: '16:00 - 00:00' };  // Shift 2 ER + Ward
                    } else {
                        return { erDoctor: row[5], wardDoctor: row[6], shift: '00:00 - 08:00' };  // Shift 3 ER + Ward
                    }
                }
            }
            return null;
        }

        // Display specialist on-call information
        async function displaySpecialistOnCall() {
            const data = await fetchData('Sheet2');
            const specialistOnCall = findCurrentShift(data);

            const specialistDiv = document.getElementById('specialist');
            if (specialistOnCall) {
                specialistDiv.innerHTML = `
                    <p class="doctor-info">ER: ${specialistOnCall.erDoctor || 'N/A'}</p>
                    <p>Ward: ${specialistOnCall.wardDoctor || 'N/A'}</p>
                    <p>Duty Time: ${specialistOnCall.shift}</p>
                `;
            } else {
                specialistDiv.textContent = 'No specialist is currently on-call.';
            }
        }

        displaySpecialistOnCall();
    </script>
</body>
</html>