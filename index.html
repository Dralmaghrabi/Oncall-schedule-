<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>On-Call Schedules</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .card {
            border: 1px solid #ccc;
            padding: 15px;
            margin-bottom: 20px;
        }
        .card h2 {
            margin-top: 0;
        }
    </style>
</head>
<body>

    <h1>On-Call Schedules</h1>

    <div class="card">
        <h2>Consultant On-Call</h2>
        <div id="consultantOnCall">Loading...</div>
    </div>

    <div class="card">
        <h2>Specialist On-Call</h2>
        <div id="specialistOnCall">Loading...</div>
    </div>

    <script>
        // Assuming date format in Google Sheets: DD/MM/YYYY
        function fetchConsultantAndSpecialistData() {
            const currentTime = new Date();
            const currentHour = currentTime.getHours();
            const currentDay = currentTime.getDate();
            const currentMonth = currentTime.getMonth() + 1; // Month is 0-indexed
            const currentYear = currentTime.getFullYear();

            const formattedDate = `${currentDay.toString().padStart(2, '0')}/${currentMonth.toString().padStart(2, '0')}/${currentYear}`;

            fetchConsultantData(formattedDate, currentHour);
            fetchSpecialistData(formattedDate, currentHour);
        }

        function fetchConsultantData(date, hour) {
            fetch('https://sheets.googleapis.com/v4/spreadsheets/14d9VWCmjCE7_PcbLk73nLod08Y4eMlVB/values/Sheet1?key=AIzaSyAAv9OhKvEt5A6dpzr3gSfAEDiu8_IL8PQ')
            .then(response => response.json())
            .then(data => {
                const rows = data.values;
                let consultantOnCall = "No consultant is currently on call.";

                for (let i = 1; i < rows.length; i++) {
                    const rowDate = rows[i][0]; // Assuming date is in the first column (A)
                    const doctor = rows[i][2];  // Consultant name in 3rd column
                    const contact = rows[i][4]; // Contact number in 5th column

                    // Match the date and hour for a consultant on-call duty
                    if (rowDate === date && hour >= 8 && hour < 8 + 24) {
                        consultantOnCall = `
                            <strong>Doctor:</strong> ${doctor} <br>
                            <strong>Contact:</strong> ${contact} <br>
                            <strong>Duty Time:</strong> 08:00 - 08:00
                        `;
                        break;
                    }
                }

                document.getElementById("consultantOnCall").innerHTML = consultantOnCall;
            });
        }

        function fetchSpecialistData(date, hour) {
            fetch('https://sheets.googleapis.com/v4/spreadsheets/14d9VWCmjCE7_PcbLk73nLod08Y4eMlVB/values/Sheet2?key=AIzaSyAAv9OhKvEt5A6dpzr3gSfAEDiu8_IL8PQ')
            .then(response => response.json())
            .then(data => {
                const rows = data.values;
                let specialistOnCall = "No specialist is currently on call.";

                for (let i = 1; i < rows.length; i++) {
                    const rowDate = rows[i][0]; // Assuming date is in the first column (A)
                    const shift1ER = rows[i][2];  // Shift 1 ER in 3rd column
                    const shift2ER = rows[i][3];  // Shift 2 ER in 4th column
                    const shift2Ward = rows[i][4];  // Shift 2 Ward in 5th column
                    const shift3ER = rows[i][5];  // Shift 3 ER in 6th column
                    const shift3Ward = rows[i][6];  // Shift 3 Ward in 7th column

                    if (rowDate === date) {
                        if (hour >= 8 && hour < 16) {
                            specialistOnCall = `
                                <strong>Current Shift:</strong> ER: ${shift1ER}, Ward: N/A
                            `;
                        } else if (hour >= 16 && hour < 24) {
                            specialistOnCall = `
                                <strong>Current Shift:</strong> ER: ${shift2ER}, Ward: ${shift2Ward}
                            `;
                        } else if (hour >= 0 && hour < 8) {
                            specialistOnCall = `
                                <strong>Current Shift:</strong> ER: ${shift3ER}, Ward: ${shift3Ward}
                            `;
                        }
                        break;
                    }
                }

                document.getElementById("specialistOnCall").innerHTML = specialistOnCall;
            });
        }

        // Call this function when the page loads
        fetchConsultantAndSpecialistData();
    </script>
</body>
</html>