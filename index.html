<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>On-Call Schedules</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            margin: 20px;
        }
        h1 {
            text-align: center;
        }
        .schedule {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 20px;
        }
        .section-title {
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>On-Call Schedules</h1>
    <div class="schedule">
        <h2>Consultant On-Call</h2>
        <p id="consultant">Loading Consultant data...</p>
    </div>
    <div class="schedule">
        <h2>Specialist On-Call</h2>
        <p id="specialist">Loading Specialist data...</p>
    </div>
</div>

<script>
    const API_KEY = 'AIzaSyAAv9OhKvEt5A6dpzr3gSfAEDiu8_IL8PQ';
    const SPREADSHEET_ID = '1-s7A-sGm19mClB1ryzEYbAWIm9hptVoPqjKZTs9ho7A';
    const CONSULTANT_RANGE = 'Sheet1!A:E';
    const SPECIALIST_RANGE = 'Sheet2!A:H';

    function getCurrentDateTime() {
        const now = new Date();
        const day = String(now.getDate()).padStart(2, '0');
        const month = String(now.getMonth() + 1).padStart(2, '0'); // Months are 0-based
        const year = now.getFullYear();
        const date = `${day}/${month}/${year}`;  // Date in DD/MM/YYYY format
        const time = now.getHours() + ':' + now.getMinutes(); // Time in HH:MM format
        return { date, time };
    }

    function isCurrentShift(startTime, endTime, currentTime) {
        const [startHour, startMinute] = startTime.split(':').map(Number);
        const [endHour, endMinute] = endTime.split(':').map(Number);
        const [currentHour, currentMinute] = currentTime.split(':').map(Number);

        const start = startHour * 60 + startMinute;
        const end = endHour * 60 + endMinute;
        const current = currentHour * 60 + currentMinute;

        if (start < end) {
            return current >= start && current <= end;
        } else {
            return current >= start || current <= end;
        }
    }

    function fetchData(range, callback) {
        fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${range}?key=${API_KEY}`)
            .then(response => response.json())
            .then(data => callback(data.values))
            .catch(error => console.error('Error:', error));
    }

    function displayConsultantData(data) {
        const { date, time } = getCurrentDateTime();
        const currentConsultant = data.find(row => row[0] === date);
        const consultantElement = document.getElementById('consultant');

        if (currentConsultant) {
            consultantElement.innerHTML = `
                <strong>Doctor:</strong> ${currentConsultant[3]}<br>
                <strong>Contact:</strong> ${currentConsultant[4]}<br>
                <strong>Duty Time:</strong> ${currentConsultant[2]} - ${currentConsultant[3]}
            `;
        } else {
            consultantElement.innerHTML = 'No consultant is currently on-call.';
        }
    }

    function displaySpecialistData(data) {
        const { date, time } = getCurrentDateTime();
        const currentSpecialist = data.find(row => row[0] === date);
        const specialistElement = document.getElementById('specialist');

        if (currentSpecialist) {
            specialistElement.innerHTML = `
                <strong>ER Specialist:</strong> ${currentSpecialist[3]}<br>
                <strong>ER Contact:</strong> ${currentSpecialist[4]}<br>
                <strong>Shift 1 (08:00 - 16:00):</strong> ${currentSpecialist[3]}<br>
                <strong>Shift 2 (16:00 - 00:00):</strong> ${currentSpecialist[5]}<br>
                <strong>Shift 3 (00:00 - 08:00):</strong> ${currentSpecialist[6]}
            `;
        } else {
            specialistElement.innerHTML = 'No specialist is currently on-call.';
        }
    }

    fetchData(CONSULTANT_RANGE, displayConsultantData);
    fetchData(SPECIALIST_RANGE, displaySpecialistData);

</script>

</body>
</html>