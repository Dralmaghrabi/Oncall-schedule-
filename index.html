<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>On-Call Schedules</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h2 {
            color: #2c3e50;
        }
        .schedule {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }
        .schedule strong {
            display: block;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <h2>Consultant On-Call Information</h2>
    <div id="consultant-schedule" class="schedule">Loading consultant data...</div>

    <h2>Specialist On-Call Information</h2>
    <div id="specialist-schedule" class="schedule">Loading specialist data...</div>

    <script>
        // Google Sheets API setup
        const apiKey = 'AIzaSyAAv9OhKvEt5A6dpzr3gSfAEDiu8_IL8PQ';  // Your provided API key
        const sheetId = '1-s7A-sGm19mClB1ryzEYbAWIm9hptVoPqjKZTs9ho7A'; // Google Sheet ID

        // Sheet URLs for Consultant (Sheet1) and Specialist (Sheet2)
        const consultantUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/Sheet1?key=${apiKey}`;
        const specialistUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/Sheet2?key=${apiKey}`;

        // Function to fetch data from Google Sheets
        async function fetchData(url) {
            const response = await fetch(url);
            const data = await response.json();
            return data.values;  // Assuming the data is in 'values' array
        }

        // Helper function to format date as yyyy-mm-dd
        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        // Function to get the current consultant or specialist based on the current date and time
        function getCurrentOnDuty(data) {
            const now = new Date();
            const currentDate = formatDate(now);
            const currentHour = now.getHours();
            let currentRow = null;

            data.forEach((row, index) => {
                if (index > 0) {  // Skip header row
                    const rowDate = row[0];
                    if (rowDate === currentDate) {
                        // For consultants: check if current hour is within duty time (08:00 to 08:00)
                        if (currentHour >= 8 || currentHour < 8) {
                            currentRow = row;
                        }
                    }
                }
            });

            return currentRow;
        }

        // Function to display the Consultant data (Sheet1)
        function displayConsultantData(data) {
            const consultantDiv = document.getElementById('consultant-schedule');
            const currentRow = getCurrentOnDuty(data);
            consultantDiv.innerHTML = ""; // Clear previous data

            if (currentRow) {
                consultantDiv.innerHTML = `<strong>Doctor:</strong> ${currentRow[1]} <br><strong>Contact:</strong> ${currentRow[4]} <br><strong>Duty Time:</strong> ${currentRow[2]} - ${currentRow[3]}`;
            } else {
                consultantDiv.innerHTML = "No consultant is currently on call.";
            }
        }

        // Function to display the Specialist data (Sheet2)
        function displaySpecialistData(data) {
            const specialistDiv = document.getElementById('specialist-schedule');
            const currentRow = getCurrentOnDuty(data);
            specialistDiv.innerHTML = ""; // Clear previous data

            if (currentRow) {
                specialistDiv.innerHTML = `<strong>Date:</strong> ${currentRow[0]} (${currentRow[1]}) <br>
                                           <strong>Shift 1 (ER):</strong> ${currentRow[2]} <br>
                                           <strong>Shift 2 (ER):</strong> ${currentRow[3]} <br>
                                           <strong>Shift 2 (Ward):</strong> ${currentRow[4]} <br>
                                           <strong>Shift 3 (ER):</strong> ${currentRow[5]} <br>
                                           <strong>Shift 3 (Ward):</strong> ${currentRow[6]}`;
            } else {
                specialistDiv.innerHTML = "No specialist is currently on call.";
            }
        }

        // Function to handle loading the data
        async function loadSchedules() {
            const consultantData = await fetchData(consultantUrl);
            const specialistData = await fetchData(specialistUrl);

            // Display both Consultant and Specialist schedules
            displayConsultantData(consultantData);
            displaySpecialistData(specialistData);
        }

        // Load the data when the page is ready
        document.addEventListener('DOMContentLoaded', loadSchedules);
    </script>
</body>
</html>