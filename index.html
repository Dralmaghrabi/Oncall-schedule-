<!DOCTYPE html>
<html>
  <head>
    <title>On-Call Schedules</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
      }
      h1 {
        font-size: 24px;
      }
      .box {
        border: 1px solid #000;
        padding: 10px;
        margin: 20px;
        width: 300px;
        display: inline-block;
        text-align: left;
      }
    </style>
    <script>
      const apiKey = "AIzaSyAAv9OhKvEt5A6dpzr3gSfAEDiu8_IL8PQ";
      const spreadsheetId = "1-s7A-sGm19mClB1ryzEYbAWIm9hptVoPqjKZTs9ho7A";

      function fetchSchedule(sheetName) {
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${sheetName}?key=${apiKey}`;
        return fetch(url)
          .then((response) => response.json())
          .then((data) => data.values);
      }

      function findCurrentOnCall(data, isConsultant) {
        const now = new Date();
        const todayDate = `${String(now.getDate()).padStart(2, '0')}/${String(now.getMonth() + 1).padStart(2, '0')}/${now.getFullYear()}`;
        const currentTime = now.getHours();
        for (let i = 1; i < data.length; i++) {
          const row = data[i];
          const [date, , name1, shift1ER, shift2ER, shift2Ward, shift3ER, shift3Ward] = row;
          if (date === todayDate) {
            if (isConsultant) {
              return { name: name1 };
            } else {
              let shiftName = "";
              if (currentTime >= 8 && currentTime < 16) shiftName = `ER: ${shift1ER}`;
              else if (currentTime >= 16 && currentTime < 24) shiftName = `ER: ${shift2ER}, Ward: ${shift2Ward}`;
              else shiftName = `ER: ${shift3ER}, Ward: ${shift3Ward}`;

              return { shiftName };
            }
          }
        }
        return null;
      }

      function displaySchedule(type, data, isConsultant) {
        const scheduleBox = document.getElementById(`${type}-schedule`);
        if (data) {
          if (isConsultant) {
            scheduleBox.innerHTML = `<strong>Doctor:</strong> ${data.name}`;
          } else {
            scheduleBox.innerHTML = `<strong>Current Shift:</strong> ${data.shiftName}`;
          }
        } else {
          scheduleBox.innerHTML = `No ${type} is currently on-call.`;
        }
      }

      function loadSchedules() {
        fetchSchedule("Sheet1").then((consultantData) => {
          const consultantOnCall = findCurrentOnCall(consultantData, true);
          displaySchedule("consultant", consultantOnCall, true);
        });

        fetchSchedule("Sheet2").then((specialistData) => {
          const specialistOnCall = findCurrentOnCall(specialistData, false);
          displaySchedule("specialist", specialistOnCall, false);
        });
      }

      window.onload = loadSchedules;
    </script>
  </head>
  <body>
    <h1>On-Call Schedules</h1>
    <div class="box" id="consultant-schedule">
      <h2>Consultant On-Call</h2>
      Loading...
    </div>
    <div class="box" id="specialist-schedule">
      <h2>Specialist On-Call</h2>
      Loading...
    </div>
  </body>
</html>